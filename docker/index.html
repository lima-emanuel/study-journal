
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lima-emanuel.github.io/study-journal/docker/">
      
      
        <link rel="prev" href="../aws/">
      
      
        <link rel="next" href="../gcp/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Docker - My Study Journal</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.5745c1f4.css">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Noto Sans Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#notes-on-docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Study Journal" class="md-header__button md-logo" aria-label="My Study Journal" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Study Journal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/lima-emanuel/study-journal" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../bash/" class="md-tabs__link">
          
  
  
  Programming Languages

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ansible/" class="md-tabs__link">
          
  
  
  DevOps

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../sysadmin/" class="md-tabs__link">
          
  
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../agile/" class="md-tabs__link">
          
  
  
  Software Engineering

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Study Journal" class="md-nav__button md-logo" aria-label="My Study Journal" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Study Journal
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lima-emanuel/study-journal" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../bash/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Programming Languages
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ansible/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ansible
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-side" class="md-nav__link">
    <span class="md-ellipsis">
      Server Side
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Side">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runc" class="md-nav__link">
    <span class="md-ellipsis">
      runc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerd" class="md-nav__link">
    <span class="md-ellipsis">
      containerd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Example Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shims" class="md-nav__link">
    <span class="md-ellipsis">
      Shims
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side" class="md-nav__link">
    <span class="md-ellipsis">
      Client Side
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client Side">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#management-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Management Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#images" class="md-nav__link">
    <span class="md-ellipsis">
      Images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registries" class="md-nav__link">
    <span class="md-ellipsis">
      Registries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifests" class="md-nav__link">
    <span class="md-ellipsis">
      Manifests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    <span class="md-ellipsis">
      Running
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-healing" class="md-nav__link">
    <span class="md-ellipsis">
      Self-Healing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-containerization" class="md-nav__link">
    <span class="md-ellipsis">
      App Containerization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-stage-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Stage Builds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-model-runner" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Model Runner
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    <span class="md-ellipsis">
      Networking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    <span class="md-ellipsis">
      Volumes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Google Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../json/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Networking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../one/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenNebula
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yaml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    YAML
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../sysadmin/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../agile/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Engineering
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#server-side" class="md-nav__link">
    <span class="md-ellipsis">
      Server Side
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Side">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runc" class="md-nav__link">
    <span class="md-ellipsis">
      runc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#containerd" class="md-nav__link">
    <span class="md-ellipsis">
      containerd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Example Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shims" class="md-nav__link">
    <span class="md-ellipsis">
      Shims
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-side" class="md-nav__link">
    <span class="md-ellipsis">
      Client Side
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Client Side">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#management-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Management Commands
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#images" class="md-nav__link">
    <span class="md-ellipsis">
      Images
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pulling" class="md-nav__link">
    <span class="md-ellipsis">
      Pulling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registries" class="md-nav__link">
    <span class="md-ellipsis">
      Registries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manifests" class="md-nav__link">
    <span class="md-ellipsis">
      Manifests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    <span class="md-ellipsis">
      Running
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-healing" class="md-nav__link">
    <span class="md-ellipsis">
      Self-Healing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-containerization" class="md-nav__link">
    <span class="md-ellipsis">
      App Containerization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-stage-builds" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Stage Builds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-model-runner" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Model Runner
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    <span class="md-ellipsis">
      Networking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    <span class="md-ellipsis">
      Volumes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="notes-on-docker">Notes on Docker</h1>
<h2 id="server-side">Server Side</h2>
<p>The Docker Engine is modular and built from many small specialized components pulled from projects such as the OCI, the CNCF, and the Moby project.</p>
<p><img alt="image" src="../img/docker_engine1.jpg" /></p>
<h3 id="runc">runc</h3>
<p><code>runc</code> is the reference implementation of the OCI runtime-spec. It is a lightweight CLI wrapper for <code>libcontainer</code> that you can download and use to manage OCI-compliant containers. However, it’s a very low-level tool and lacks almost all of the features and add-ons you get with the Docker Engine. It is said that <code>runc</code> operates at the OCI layer, and we often refer to it as a low-level runtime.</p>
<p>Docker and Kubernetes both use <code>runc</code> as their default low-level runtime, and both pair it with the <code>containerd</code> high-level runtime:</p>
<ul>
<li><code>containerd</code> operates as the high-level runtime managing lifecycle events;</li>
<li><code>runc</code> operates as the low-level runtime executing lifecycle events by interfacing with the kernel to do the work of actually building containers and deleting them.</li>
</ul>
<h3 id="containerd">containerd</h3>
<p><code>containerd</code> as a high-level runtime as it manages lifecycle events such as starting, stopping, and deleting containers. However, it needs a low-level runtime to perform the actual work. Most of the time, <code>containerd</code> is paired with <code>runc</code> as its low-level runtime. However, it uses shims that make it possible to replace <code>runc</code> with other low-level runtimes. It has grown to include the ability to also manage images, networks, and volumes.</p>
<h3 id="example-workflow">Example Workflow</h3>
<p>When you run <code>docker run -d --name ctr1 nginx</code>, the Docker client converts them into API requests and sends them to the API exposed by the daemon. The daemon can expose the API on a local socket or over the network. On Linux, the local socket is <code>/var/run/docker.sock</code> and on Windows it’s <code>\pipe\docker_engine</code>. The daemon receives the request, interprets it as a request to create a new container, and passes it to <code>containerd</code>. The daemon communicates with containerd via a CRUD-style API over <code>gRPC</code> . Despite its name, even <code>containerd</code> cannot create containers. It converts the required Docker image into an OCI bundle and tells <code>runc</code> to use this to create a new container. <code>runc</code> interfaces with the OS kernel to pull together all the constructs necessary to create a container (namespaces, cgroups, etc.). The container starts as a child process of <code>runc</code>, and as soon as the container starts, <code>runc</code> exits.</p>
<h3 id="shims">Shims</h3>
<p>Shims are a popular software engineering pattern, and the Docker Engine uses them in between containerd and the OCI layer, bringing the following benefits:</p>
<ul>
<li>Daemonless containers;</li>
<li>Improved efficiency;</li>
<li>Pluggable OCI layer.</li>
</ul>
<p>Daemonless containers is the ability to stop, restart, and even update the Docker daemon without impacting running containers. On the efficiency front, <code>containerd</code> forks a shim and a <code>runc</code> process for every new container. However, each <code>runc</code> process exits as soon as the container starts running, leaving the shim process as the container’s parent process. The shim is lightweight and sits between <code>containerd</code> and the container. It reports on the container’s status and performs low-level tasks such as keeping the container’s STDIN and STDOUT streams open. Shims also make it possible to replace <code>runc</code> with other low-level runtimes.</p>
<h2 id="client-side">Client Side</h2>
<h3 id="management-commands">Management Commands</h3>
<ul>
<li><code>builder</code> and <code>buildx</code>:     Manage builds with extended capabilities through BuildKit;</li>
<li><code>compose</code>:                  Define and run multi-container applications with Docker;</li>
<li><code>container</code>:                Manage containers, such as copying files between a container and the local filesystem;</li>
<li><code>context</code>:                  Manage contexts, such as creating, exporting and listing them;</li>
<li><code>image</code>:                    Manage images, such as building, listing and importing them;</li>
<li><code>manifest</code>:                 Manage Docker image manifests and manifest lists, such as creating and inspecting it;</li>
<li><code>network</code>:                  Manage networks, such as connecting a container to a network or creating it;</li>
<li><code>plugin</code>:                   Manage plugins, such as creating, enabling and installing it;</li>
<li><code>system</code>:                   Manage Docker itself, such as showing disk usage and pruning used space;</li>
<li><code>trust</code>:                    Manage trust on Docker images, such as inspecting keys and signers of images;</li>
<li><code>volume</code>:                   Manage volumes, such as creating, listing and pruning them.</li>
</ul>
<h2 id="images">Images</h2>
<p>An image is a read-only package containing everything needed to run an application. This means they include application code, dependencies, a minimal set of OS constructs, and metadata. Multiple containers can be started from a single image. As such, images are build-time constructs, whereas containers are run-time constructs.</p>
<p>Docker creates images by stacking independent layers and representing them as a single unified object. One layer might have the OS components, another layer might have application dependencies, and another layer might have the application.</p>
<p>The <code>docker container run</code> command is the most common way to start a container from an image. Once the container is running, the image and the container are bound, and you cannot delete the image until you stop and delete the container. If multiple containers use the same image, you can only delete the image after you’ve deleted all the containers using it.</p>
<p><code>docker inspect registry/user/repository:tag</code> can be used to gather information about an image, like seeing if it has an <code>Entrypoint</code>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>docker<span class="w"> </span>inspect<span class="w"> </span>nigelpoulton/ddd-book:web0.1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Entrypoint<span class="w"> </span>-A<span class="w"> </span><span class="m">3</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1"># &quot;Entrypoint&quot;: [</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">#     &quot;node&quot;,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1">#     &quot;./app.js&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="c1"># ],</span>
</span></code></pre></div>
<h3 id="pulling">Pulling</h3>
<p><em>Local repository</em> is jargon for an area on your local machine where Docker stores images for more convenient access. We sometimes call it the image cache, and on Linux it’s usually located in <code>/var/lib/docker/&lt;storage-driver&gt;</code>.</p>
<p><code>docker image pull name</code> pulls image <code>name</code> layer by layer. If not set, it always assumes the latest tag and pulls from Docker Hub. Docker only pulls the layers that are not already downloaded because layers can be shared between images.</p>
<p><img alt="image" src="../img/layers.jpg" /></p>
<p>One makes changes to images by stacking new layers on top of old ones, containing updated files.</p>
<p><img alt="image" src="../img/update_layer.jpg" /></p>
<p>Here, file 7 updated file 5.</p>
<p>One can also pull an image by its digest. A digest is the hash of an image content, so it's more reliable than tags to ensure unicity.</p>
<p>To find out the digest of an image:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>imagetools<span class="w"> </span>inspect<span class="w"> </span>registry/user/repository:tag
</span></code></pre></div>
<p>To pull using the digest:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>docker<span class="w"> </span>pull<span class="w"> </span>registry/user/repository@sha256:13dd59a0
</span></code></pre></div>
<p>It’s also possible to directly query the registry API for image data, including digest:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>curl<span class="w"> </span><span class="s2">&quot;https://hub.docker.com/v2/repositories/nigelpoulton/k8sbook/tags/?name=latest&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.results[].digest&#39;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1"># &quot;sha256:13dd59a0c74e9a147800039b1ff4d61201375c008b96a29c5bd17244bce2e14b&quot;</span>
</span></code></pre></div>
<p>An image is just a manifest file with some metadata and a list of layers. The actual application and all its dependencies live in the layers that are fully independent and have no concept of being part of an image. As such:</p>
<ul>
<li>Images digests are a crypto hash of the image’s manifest file</li>
<li>Layer digests are a crypto hash of the layer’s contents</li>
</ul>
<p>Docker compares hashes before and after every push and pull to ensure no tampering occurs while data is crossing the network.</p>
<p><code>docker rmi &lt;image&gt;:&lt;tag&gt;</code>  or <code>docker image rm &lt;image&gt;:&lt;tag&gt;</code> will delete an image from a local repository.</p>
<h3 id="registries">Registries</h3>
<p>Registries that implement the OCI distribution-spec are called OCI registries. Image registries contain one or more image repositories, and image repositories contain one or more images. The default registry is Docker Hub, but others exist, including 3rd-party internet-based registries and secure on-premises registries.</p>
<p>Image names are written like so:</p>
<p><img alt="image" src="../img/image_name.jpg" /></p>
<p>To be pulled with <code>docker image pull &lt;registry&gt;/&lt;user&gt;/&lt;repository&gt;:&lt;tag&gt;</code>.</p>
<h3 id="manifests">Manifests</h3>
<p>The manifest list is a list of architectures supported by an image tag. Each supported architecture then has its own manifest that lists the layers used to build it. <code>docker buildx imagetools inspect</code> can be used to see it.</p>
<p><img alt="image" src="../img/manifest_list.jpg" /></p>
<h2 id="containers">Containers</h2>
<p>Containers are run-time instances of images, and one or more containers can be started from a single image. They’re designed to be stateless, immutable and ephemeral. Containers should only run a single process.</p>
<p>The image of a container is read-only, but each container is read-write. each container has its own thin R/W layer but shares the same image. The containers can see and access the files and apps in the image through their own R/W layer, and if they make any changes, these get written to their R/W layer. When you stop a container, Docker keeps the R/W layer and restores it when you restart the container. However, when you delete a container, Docker deletes its R/W layer. This way, each container can make and keep its own changes without requiring write access to the shared image.</p>
<p><img alt="image" src="../img/rw_layer.jpg" /></p>
<h3 id="running">Running</h3>
<p>A container can be run like so:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-d<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">60</span>
</span></code></pre></div>
<p>This starts a new background container based on the Alpine image and tells it to run the <code>sleep 60</code> command, causing it to run for 60 seconds and then exit. The <code>--rm</code> flag cleans up the exited container so it doesn`t have to be deleted manually.</p>
<p>One can start an interactive <code>exec</code> session on a running container like so:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>name<span class="w"> </span>sh
</span></code></pre></div>
<p>Removing the <code>-it</code> option makes the execution remote.</p>
<p>Most containers only run a single process. This is the container’s main app process and is always PID 1. If the container’s main process (PID 1) is killed, the container will also be.</p>
<p><code>docker inspect</code> can provide information about running containers.</p>
<p><code>docker container ls</code> or <code>docker ps</code> shows the running containers on the host.</p>
<p><code>docker container rm &lt;name&gt;</code>, <code>docker container stop &lt;name&gt;</code> and <code>docker container restart &lt;name&gt;</code> removes, stops and restarts the container.</p>
<p><code>docker container attach &lt;name&gt;</code> will connect STD{IN,OUT,ERR} to the running container.</p>
<h3 id="self-healing">Self-Healing</h3>
<p>Container restart policies are a simple form of self-healing that allows the local Docker Engine to automatically restart failed containers. The policies are: <code>no</code>, <code>on-failure</code>, <code>always</code> and <code>unless-stopped</code>:</p>
<p><img alt="image" src="../img/restart.jpg" /></p>
<p>The policy is defined as option <code>--restart &lt;policy&gt;</code> to <code>docker run</code>.</p>
<h3 id="app-containerization">App Containerization</h3>
<p><img alt="image" src="../img/app.jpg" /></p>
<ol>
<li>Write your application and create a list of dependencies</li>
<li>Create a Dockerfile that tells Docker how to build and run the app</li>
<li>Build the app into an image</li>
<li>Push the image to a registry (optional)</li>
<li>Run a container from the image</li>
</ol>
<p><strong>(2)</strong> is done by writting a Dockerfile. Comments are done with <code>#</code>. All non-comment lines are called instructions or steps and take the format <code>&lt;INSTRUCTION&gt; &lt;arguments&gt;</code>. Some instructions create new layers, whereas others add metadata. Examples of instructions that create new layers are <code>FROM</code>, <code>RUN</code>, <code>COPY</code> and <code>WORKDIR</code>. Examples that create metadata include <code>EXPOSE</code>, <code>ENV</code>, <code>CMD</code>, and <code>ENTRYPOINT</code>. The premise is this:</p>
<ul>
<li>Instructions that add content, such as files and programs, create new layers</li>
<li>Instructions that don’t add content don’t add layers and only create metadata</li>
</ul>
<p><code>docker history &lt;image&gt;</code> shows the steps that created it. Lines with a non-zero value in the <code>SIZE</code> column created new layers, whereas the lines with 0B only added metadata.</p>
<p><strong>(3)</strong> is done by running <code>docker build -t &lt;name&gt;:&lt;tag&gt; -f &lt;Dockerfile Path&gt; .</code>, where <code>.</code> is the path to the <em>build context</em> (where the app files live). The final number of layers is the sum of all Dockerfile commands that created layers plus the number of layers of the base image.</p>
<p><strong>(4)</strong> is done by running <code>docker login</code> to login to Docker Hub and then running <code>docker push &lt;repository&gt;/&lt;name&gt;:&lt;tag&gt;</code>. Re-tag the image with <code>docker tag &lt;current-tag&gt; &lt;new-tag&gt;</code> if the name of the image doesn't follow <code>&lt;repository&gt;/&lt;name&gt;:&lt;tag&gt;</code>.</p>
<p><strong>(5)</strong> is done through <code>docker run</code>.</p>
<h3 id="multi-stage-builds">Multi-Stage Builds</h3>
<p>Multi-stage builds use a single Dockerfile with multiple <code>FROM</code> instructions — each <code>FROM</code> instruction represents a new build stage. This allows one to have a stage where one does the heavy lifting of building the app inside a large image with compilers and other build tools, but then you have another stage where you copy the compiled app into a slim image for production. The builder can even run different stages in parallel for faster builds. Example:</p>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c"># Stage 0</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.23.4-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/src</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>.
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="c"># Stage 1</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build-client</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>/bin/client<span class="w"> </span>./cmd/client
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="c"># Stage 2</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build-server</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>/bin/server<span class="w"> </span>./cmd/server
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="c"># Stage 3</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="k">FROM</span><span class="w"> </span><span class="s">scratch</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">prod</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build-client<span class="w"> </span>/bin/client<span class="w"> </span>/bin/
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build-server<span class="w"> </span>/bin/server<span class="w"> </span>/bin/
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;/bin/server&quot;</span><span class="w"> </span><span class="p">]</span>
</span></code></pre></div>
<p>Each stage outputs an intermediate image that later stages can use. However, Docker deletes them when the final stage completes. The builder will run the <code>base</code> stage first, then run the <code>build-client</code> and <code>build-server</code> stages in parallel, and finally run the <code>prod</code> stage. The goal of the <code>base</code> stage is to create a reusable build image with all the tools stages 1 and 2 need to build the client and server applications. The <code>build-client</code> and <code>build-server</code> stages don’t pull a new image. Instead, they use the <code>FROM base AS build-client</code> and <code>FROM base AS build-server</code> instruction to use the intermediate image created by the <code>base</code> stage. <code>prod</code> will have only 2 layers because of the two <code>COPY</code> steps.</p>
<p>The <code>prod</code> stage could be divided in two like so:</p>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c"># Stage 0</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.23.4-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/src</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>.
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c"># Stage 1</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build-client</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>/bin/client<span class="w"> </span>./cmd/client
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="c"># Stage 2</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build-server</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>/bin/server<span class="w"> </span>./cmd/server
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="c"># Stage 3</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="k">FROM</span><span class="w"> </span><span class="s">scratch</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">prod-client</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build-client<span class="w"> </span>/bin/client<span class="w"> </span>/bin/
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;/bin/client&quot;</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="c"># Stage 4</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="k">FROM</span><span class="w"> </span><span class="s">scratch</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">prod-server</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build-server<span class="w"> </span>/bin/server<span class="w"> </span>/bin/
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;/bin/server&quot;</span><span class="w"> </span><span class="p">]</span>
</span></code></pre></div>
<p>On this case, it's necessary to tell <code>docker build</code> the target: <code>--target prod-server</code> or <code>--target prod-client</code>.</p>
<p>Behind the scenes, Docker’s build system has a client (<code>Buildx</code>) and server (<code>BuildKit</code>). You can configure <code>Buildx</code> to talk to multiple <code>BuildKit</code> instances, and we call each instance of <code>BuildKit</code> a builder. Builders can run on your local machine, in your cloud or datacenter, or Docker’s Build Cloud (paid).</p>
<p>When you run a <code>docker build</code> command, <code>buildx</code> interprets the command and sends the build request to the selected builder through a driver. This includes the Dockerfile, command line arguments, caching options, export options, and the build context (app and dependency list). The builder performs the build and exports the image. The <code>Buildx</code> client monitors the build and reports on progress. The driver is <code>docker-container</code> for local builds and <code>cloud</code> for remote builds.</p>
<p><code>docker buildx ls</code> lists the available builders. The one with the asterisk (*) is the default builder.</p>
<p><code>docker buildx create --driver=docker-container --name=container</code> creates a new builder called <code>container</code> that uses the <code>docker-container</code> driver.</p>
<p><code>docker buildx use container</code> makes it the default.</p>
<p><code>docker buildx build --builder=container --platform=linux/amd64,linux/arm64 -t repository/name:tag --push .</code> builds the image for x86 and ARM and pushes it to Docker Hub using the previously created builder. Use <code>--load</code> instead of <code>--push</code> to not publish the image.</p>
<h2 id="docker-model-runner">Docker Model Runner</h2>
<p>TODO</p>
<h2 id="networking">Networking</h2>
<p>TODO</p>
<h2 id="volumes">Volumes</h2>
<p>TODO</p>
<h2 id="security">Security</h2>
<p>TODO</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../aws/" class="md-footer__link md-footer__link--prev" aria-label="Previous: AWS">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                AWS
              </div>
            </div>
          </a>
        
        
          
          <a href="../gcp/" class="md-footer__link md-footer__link--next" aria-label="Next: Google Cloud">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Google Cloud
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/lima-emanuel" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.top", "navigation.footer", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="../assets/external/unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>